<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ritmos Cubanos website</title>
    <meta name="description" content="Cuban Timeline by ag-sound" />
    <meta name="author" content="ag-sound" />

    <meta property="og:title" content="ritmo-cubano-timeline" />
    <meta property="og:description" content="Cuban Timeline by ag-sound" />
    <meta property="og:type" content="website" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="google-ads-consent-enabled" content="true" />

    <!-- Google CMP (Funding Choices) + Consent Mode -->
    <script>
      // Make sure the googlefc namespace exists before the CMP loads.
      window.googlefc = window.googlefc || {};
      window.googlefc.callbackQueue = window.googlefc.callbackQueue || [];
    </script>
    <script async src="https://fundingchoicesmessages.google.com/i/pub-5806299023049544?ers=1"></script>
    <script>
      // Signal Funding Choices presence (required by the tag).
      (function () {
        function signalGooglefcPresent() {
          if (!window.frames["googlefcPresent"]) {
            if (document.body) {
              var iframe = document.createElement("iframe");
              iframe.style.display = "none";
              iframe.name = "googlefcPresent";
              document.body.appendChild(iframe);
            } else {
              setTimeout(signalGooglefcPresent, 0);
            }
          }
        }
        signalGooglefcPresent();
      })();
    </script>

    <!-- Google tag (GA4) initialized in consent mode -->
    <script>
      (function () {
        var GA_MEASUREMENT_ID = "G-1RQSJMWL8E";

        window.dataLayer = window.dataLayer || [];
        function gtag() {
          window.dataLayer.push(arguments);
        }
        window.gtag = window.gtag || gtag;

        // Default: denied until CMP provides consent mode values.
        window.gtag("consent", "default", {
          ad_storage: "denied",
          analytics_storage: "denied",
          ad_user_data: "denied",
          ad_personalization: "denied",
          functionality_storage: "granted",
          security_storage: "granted",
        });

        window.gtag("js", new Date());
        window.gtag("config", GA_MEASUREMENT_ID);

        // When Google CMP consent-mode values are ready, mirror them into gtag.
        window.googlefc = window.googlefc || {};
        window.googlefc.callbackQueue = window.googlefc.callbackQueue || [];
        window.googlefc.callbackQueue.push({
          CONSENT_MODE_DATA_READY: function () {
            try {
              var status = window.googlefc.getGoogleConsentModeValues();
              var e = window.googlefc.ConsentModePurposeStatusEnum;
              var toConsentValue = function (purposeStatus) {
                switch (purposeStatus) {
                  case e.GRANTED:
                  case e.NOT_APPLICABLE:
                  case e.NOT_CONFIGURED:
                    return "granted";
                  case e.DENIED:
                  case e.UNKNOWN:
                  default:
                    return "denied";
                }
              };

              var analyticsConsent = toConsentValue(status.analyticsStoragePurposeConsentStatus);

              window.gtag("consent", "update", {
                ad_storage: toConsentValue(status.adStoragePurposeConsentStatus),
                analytics_storage: analyticsConsent,
                ad_user_data: toConsentValue(status.adUserDataPurposeConsentStatus),
                ad_personalization: toConsentValue(status.adPersonalizationPurposeConsentStatus),
              });

              // Load Umami only if analytics consent is granted (or not applicable/configured).
              if (analyticsConsent === "granted") {
                if (!document.querySelector('script[data-website-id="bc9f0a35-857e-4d5b-b5ce-1bdb999fce77"]')) {
                  var umami = document.createElement("script");
                  umami.defer = true;
                  umami.src = "https://cloud.umami.is/script.js";
                  umami.setAttribute("data-website-id", "bc9f0a35-857e-4d5b-b5ce-1bdb999fce77");
                  document.head.appendChild(umami);
                }
              }
            } catch (err) {
              // If something goes wrong, keep defaults (denied).
              console.warn("Consent mode sync failed:", err);
            }
          },
        });
      })();
    </script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1RQSJMWL8E"></script>

    <!-- ðŸŒ Google Translate Setup -->
    <meta name="google" content="notranslate" />
    <style>
      /**  this works **/
      .goog-te-gadget-simple {
        border: none !important;
        display: flex !important;
        align-items: center !important;
      }

      .goog-te-gadget-simple .VIpgJd-ZVi9od-xl07Ob-lTBxed {
      }

      .goog-te-gadget-simple .VIpgJd-ZVi9od-xl07Ob-lTBxed span {
        display: inline-block !important;
        white-space: nowrap !important;
      }

      /**  this works **/
      .goog-te-gadget-simple .VIpgJd-ZVi9od-xl07Ob-lTBxed span[style*="border-left"] {
        display: none !important;
      }

      .goog-te-gadget-simple .VIpgJd-ZVi9od-xl07Ob-lTBxed span:first-child {
        padding-top: 16px !important;
        font-size: 0 !important;
      }

      .goog-te-gadget-simple .VIpgJd-ZVi9od-xl07Ob-lTBxed span:first-child::after {
        content: "Choose Lang" !important;
        font-size: 12px !important;
        display: inline-block !important;
      }

      /* Loading state styles */
      #google_translate_element.loading {
        min-width: 120px;
        min-height: 24px;
        position: relative;
      }

      #google_translate_element.loading::before {
        content: "Loading translator...";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 12px;
        color: #666;
      }
    </style>
    <script type="text/javascript">
      function googleTranslateElementInit() {
        const element = document.getElementById("google_translate_element");
        element.classList.add("loading");

        // Set a timeout to remove loading state if translation fails
        const timeout = setTimeout(() => {
          element.classList.remove("loading");
        }, 5000);

        new google.translate.TranslateElement(
          {
            pageLanguage: "en",
            includedLanguages: "en,es,fr,de,pt,it,ru,zh-CN,ja,ko,ar,hi,bn,pa,tr,vi,pl,nl,fa,sw",
            layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
            autoDisplay: false,
            multilanguagePage: true,
          },
          "google_translate_element"
        );

        // Remove loading state once translation is ready
        const observer = new MutationObserver(mutations => {
          mutations.forEach(mutation => {
            if (
              mutation.addedNodes.length &&
              mutation.addedNodes[0].className?.includes("goog-te-gadget-simple")
            ) {
              element.classList.remove("loading");
              clearTimeout(timeout);
              observer.disconnect();
            }
          });
        });

        observer.observe(element, { childList: true, subtree: true });
      }

      // Load Google Translate script with error handling
      function loadGoogleTranslate() {
        const script = document.createElement("script");
        script.type = "text/javascript";
        script.src = "//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit";
        script.onerror = () => {
          const element = document.getElementById("google_translate_element");
          element.classList.remove("loading");
          element.innerHTML =
            '<span style="color: #666; font-size: 12px;">Translation unavailable</span>';
        };
        document.head.appendChild(script);
      }

      // Load the script when the page is ready
      if (document.readyState === "complete") {
        loadGoogleTranslate();
      } else {
        window.addEventListener("load", loadGoogleTranslate);
      }
    </script>
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
